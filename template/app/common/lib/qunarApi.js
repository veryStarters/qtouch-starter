!function(a,b){"function"==typeof define?define.amd?define(function(){return b()}):define.cmd&&define(function(a,c,d){d.exports=b()}):"object"==typeof module&&"object"==typeof module.exports?module.exports=b():a.QunarAPI=b()}("undefined"!=typeof window?window:this,function(){"use strict";function a(a){return"function"==typeof a}function b(a){return"[object String]"===Object.prototype.toString.call(a)}function c(a,b){for(var c in a)i.register(c,a[c],b)}function d(){n.length>0&&(n.forEach(function(a){i.invoke(a.key,a.callback,a.param)}),n=[])}function e(a){o.length>0&&o.forEach(function(b){b(a)})}function f(a){$.ajax({url:a||p.signatureUrl,data:{url:location.href.split("#")[0]},dataType:"json",success:function(a){wx.config({debug:!1,appId:a.data.appId,timestamp:a.data.timestamp,nonceStr:a.data.nonceStr,signature:a.data.signature,jsApiList:[v.common.checkJsApi,v.common.chooseImage,v.common.closeWindow,v.common.downloadImage,v.common.getLocation,v.common.getNetworkType,v.common.hideAllNonBaseMenuItem,v.common.hideMenuItems,v.common.hideOptionMenu,v.common.openLocation,v.common.previewImage,v.common.scanQRCode,v.common.showAllNonBaseMenuItem,v.common.showMenuItems,v.common.showOptionMenu,v.common.uploadImage,v.share.wechat.onMenuShareAppMessage,v.share.wechat.onMenuShareTimeline,"onMenuShareQQ","onMenuShareWeibo","translateVoice","startRecord","stopRecord","onRecordEnd","playVoice","pauseVoice","stopVoice","uploadVoice","downloadVoice","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"]}),wx.ready(function(){for(var a in wx)a==v.common.checkJsApi?i[v.common.checkJsApi]=function(a){var b=a.success;a.success=function(a){$.each(a.checkResult,function(b,c){a[b]=c}),b(a)},wx[v.common.checkJsApi](a)}:i[a]=wx[a];i.onMenuShare=function(a){for(var b in v.share.wechat)i[b](a)},i.isReady=!0,n.forEach(function(a){a.callback.call(i)}),n=[]})},error:function(a){alert("error :  "+JSON.stringify(a))}})}function g(){if(s.wechat){var b=k.getElementsByTagName("head")[0],c=k.createElement("script");c.setAttribute("src",p.wechatApiUrl),b.appendChild(c),c.onload=function(){var a="",b=function(){return n.length&&n.filter(function(b,c,d){return"config"==b.key&&b.param.wxUrl?(a=b.param.wxUrl,d.splice(c,1),!0):void 0})};if(b().length)return void f(a);var c=1,d=setInterval(function(){b().length?f(a):c>5&&f(""),clearInterval(d)},500)}}else s.qunar&&(i.hy.onInitData=function(b){i.hy.getInitData({success:function(c){a(b.success)&&b.success(c)}})},window.addEventListener("load",function(){setTimeout(function(){i.bridge||e({ret:!1,errcode:-1,errmsg:"bridge注入失败"})},600)}))}function h(b,c,d){if(!c)return void console.error("Parameters are not allowed to be empty!");u[d]&&(c=u[d](c));var e=c.success,f=c.fail,g=c.complete,h=function(j){m.debug&&console.log(j);var k=Array.prototype.slice.call(arguments,0);j&&"undefined"!=typeof j.ret?j.ret?(k[0]=j.data,a(e)&&e.apply(null,k),t.api[d]&&t.api[d].call(c,j.data||{})):a(f)&&f.apply(null,k):(a(e)&&e.apply(null,k),t.api[d]&&t.api[d].call(c,j||{})),a(g)&&g.apply(null,k),s.qunar&&-1!=j.errcode&&t.bridge.method(d)&&i.invoke(b,h,c,d)};i.invoke(b,h,c,d)}var i={},j=window,k=j.document,l=j.navigator.userAgent,m={},n=[],o=[],p={wechatApiUrl:"http://res.wx.qq.com/open/js/jweixin-1.0.0.js",signatureUrl:"http://touch.qunar.com/api/activity/weixin/signature"},q={},r={},s=function(){return/MicroMessenger/i.test(l)?{wechat:!0,version:""}:/Qunar/i.test(l)?{qunar:!0,version:""}:{h5:!0,version:""}}(),t={api:{openWebView:function(){a(this.onViewBack)&&i.hy.onceReceiveData({success:this.onViewBack})}},bridge:{method:function(a){return v.share.wechat[a]||v.share.hy[a]?"invoke":""}}},u={checkJsApi:function(b){var c=q,d=b.success,e=b.jsApiList.slice(0);return b.jsApiList=e.map(function(a){return c[a]||a}),b.success=function(b){var f={};e.forEach(function(a){var d=c[a];f[a]=b[d]||!1}),a(d)&&d.call(null,f)},b},log:function(a){if(b(a)){var c={message:a};return c}return a}},v={common:{chooseImage:"chooseImage",previewImage:"previewImage",uploadImage:"uploadImage",downloadImage:"downloadImage",getNetworkType:"network.getType",openLocation:"openLocation",getLocation:"geolocation.getCurrentPosition",closeWindow:"webview.back",hideOptionMenu:"hideOptionMenu",showOptionMenu:"showOptionMenu",hideMenuItems:"hideMenuItems",showMenuItems:"showMenuItems",hideAllNonBaseMenuItem:"hideAllNonBaseMenuItem",showAllNonBaseMenuItem:"showAllNonBaseMenuItem",scanQRCode:"scanQRCode",checkJsApi:"checkJsApi"},share:{wechat:{onMenuShareTimeline:"onMenuShareTimeline",onMenuShareAppMessage:"onMenuShareAppMessage"},hy:{onMenuShareWeiboApp:"onMenuShareWeiboApp",onMenuShareSMS:"onMenuShareSMS",onMenuShareEmail:"onMenuShareEmail",onMenuShare:"onMenuShare"}},hy:{openWebView:"webview.open",closeWebView:"webview.back",setWebViewAttr:"webview.attribute",getInitData:"webview.getInitData",onShow:"webview.onShow",onHide:"webview.onHide",onReceiveData:"webview.onReceiveData",onceReceiveData:"webview.onReceiveData",onCloseWebView:"webview.targetClosed",onceCloseWebView:"webview.targetClosed",onBeforeShow:"webview.onBeforeShow",onBeforeHide:"webview.onBeforeHide",onDestroy:"webview.onDestroy",navRefresh:"navigation.refresh",onNavClick:"navigation.click",shareTimeline:"shareTimeline",shareAppMessage:"sendAppMessage",shareWeiboApp:"shareWeiboApp",shareSMS:"shareSMS",shareEmail:"shareEmail",shareImageToTimeline:"shareImageToTimeline",showShareItems:"doShare",getDeviceInfo:"native.getDeviceInfo",login:"login.start",syncLoginFromTouch:"syncLoginFromTouch",log:"debug.log",uelog:"hy.uelog"},h5:{getLocation:function(a,b){navigator.geolocation?navigator.geolocation.getCurrentPosition(b.success,b.fail,{enableHighAccuracy:b.enableHighAccuracy||!0,timeout:b.timeout||5e3}):a({ret:!1,errcode:-1,errmsg:"Geolocation is not supported!"})},login:function(a,b){var c,d,e,f="";d="http://user.qunar.com/mobile/login.jsp",c={ret:b.ret||encodeURIComponent(location.href),goback:b.goback||"",backUrl:b.backUrl||""};for(e in c)c.hasOwnProperty(e)&&""!==c[e]&&(f+=e+"="+c[e]);location.href=d+"?"+f},checkJsApi:function(a,b){var c,d=b.jsApiList||[],e={};d.forEach(function(a){c=r[a],e[a]=!!v.h5[c]}),a(e)},notSupport:function(b,c,d,e){a(b)&&b({ret:!1,errcode:-1,errmsg:'浏览器环境下不支持"'+e+'"接口调用'})}}};return i={version:"1.0.10",isReady:!1,bridge:null,sniff:s,ready:function(b){var c=this;s.qunar?k.addEventListener("WebViewJavascriptBridgeReady",function(e){c.isReady=!0,c.bridge=e.bridge,a(b)&&b.call(c),d()}):s.h5?(c.isReady=!0,a(b)&&b.call(c)):s.wechat&&n.push({key:"",callback:b,param:""})},config:function(a){h("config",m=a)},error:function(b){a(b)&&o.push(b)},invoke:function(b,c,d,e){if(a(c))if(i.isReady)if(s.qunar){e=e||b;var f="invoke";0===e.indexOf("once")?f="once":0===e.indexOf("on")&&(f="on"),this.bridge[t.bridge.method(e)||f](b,c,d)}else s.wechat?this[b]&&this[b](d):s.h5&&v.h5[v.h5[e]?e:"notSupport"](c,d,b,e);else n.push({key:b,callback:c,param:d})},register:function(a,b,c){var d=this,e=this;c&&(e=d[c]?d[c]:d[c]={}),q[a]=b,r[b]=a,e[a]=function(c){h(b,c,a)}}},c(v.share.wechat),c(v.share.hy),c(v.common),c(v.hy,"hy"),g(),i});